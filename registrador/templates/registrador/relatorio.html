
{% extends 'componentes/base.html' %}
{% load custom_filters %}

{% block title %}Relat√≥rio de Vendas{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>üìä Relat√≥rio de Vendas</h2>
    
    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Filtros</h5>
            <form method="GET" class="row g-3">
                <div class="col-md-2">
                    <label class="form-label">Data In√≠cio</label>
                    <input type="date" name="data_inicio" class="form-control" value="{{ data_inicio }}">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Hora In√≠cio</label>
                    <input type="time" name="hora_inicio" class="form-control" value="{{ hora_inicio }}">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Data Fim</label>
                    <input type="date" name="data_fim" class="form-control" value="{{ data_fim }}">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Hora Fim</label>
                    <input type="time" name="hora_fim" class="form-control" value="{{ hora_fim }}">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">üîç Filtrar</button>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <a href="{% url 'relatorio_vendas' %}" class="btn btn-secondary">üîÑ Limpar</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Resumo por Forma de Pagamento -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üí∞ Total por Forma de Pagamento</h5>
                    <div class="row">
                        <div class="col-6">
                            <p><strong>üíµ Dinheiro:</strong> R$ {{ totais_pagamento.Dinheiro|floatformat:2 }}</p>
                            <p><strong>üí≥ Cr√©dito:</strong> R$ {{ totais_pagamento.Credito|floatformat:2 }}</p>
                        </div>
                        <div class="col-6">
                            <p><strong>üí≥ D√©bito:</strong> R$ {{ totais_pagamento.Debito|floatformat:2 }}</p>
                            <p><strong>üì± Pix:</strong> R$ {{ totais_pagamento.Pix|floatformat:2 }}</p>
                        </div>
                    </div>
                    <hr>
                    <h4><strong>Total Geral: R$ {{ total_geral|floatformat:2 }}</strong></h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">üìà Estat√≠sticas</h5>
                    <p><strong>Total de Pedidos:</strong> {{ num_pedidos }}</p>
                    {% if num_pedidos > 0 %}
                    <p><strong>Ticket M√©dio:</strong> R$ {{ ticket_medio|floatformat:2 }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de Pedidos -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">üìã Lista de Pedidos</h5>
            {% if pedidos %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Pedido #</th>
                            <th>Data/Hora</th>
                            <th>Cliente</th>
                            <th>Local</th>
                            <th>Forma Pagamento</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pedido in pedidos %}
                        <tr>
                            <td>#{{ pedido.id }}</td>
                            <td>{{ pedido.criado_em|date:"d/m/Y H:i" }}</td>
                            <td>{{ pedido.nome_cliente|default:"N√£o informado" }}</td>
                            <td>{{ pedido.local_consumo|default:"N√£o informado" }}</td>
                            <td>
                                {% if pedido.forma_pagamento %}
                                    {% for forma in pedido.forma_pagamento|split:" | " %}
                                        <small class="d-block">{{ forma }}</small>
                                    {% endfor %}
                                {% else %}
                                    <small class="text-muted">N√£o informado</small>
                                {% endif %}
                            </td>
                            <td><strong>R$ {{ pedido.total|floatformat:2 }}</strong></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info text-center">
                <p>Nenhum pedido encontrado para o per√≠odo selecionado.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="mt-4">
        <a href="{% url 'menu' %}" class="btn btn-secondary">‚Ü©Ô∏è Voltar ao Menu</a>
    </div>
</div>
{% endblock %}
